/*
 * $Header: /AntIDE/source/ant/pool/sourcepool/SourcePool.java 9     99-05-23 8:10a Remember $
 * Ant ( JDK wrapper Java IDE )
 * Version 1.0
 * Copyright (c) 1998-1999 Antsoft Co. All rights reserved.
 *  This program and source file is protected by Korea and international
 * Copyright laws.
 *
 * $Revision: 9 $
 * $History: SourcePool.java $
 * 
 * *****************  Version 9  *****************
 * User: Remember     Date: 99-05-23   Time: 8:10a
 * Updated in $/AntIDE/source/ant/pool/sourcepool
 * 
 * *****************  Version 8  *****************
 * User: Remember     Date: 99-05-22   Time: 11:23p
 * Updated in $/AntIDE/source/ant/pool/sourcepool
 * 
 * *****************  Version 7  *****************
 * User: Remember     Date: 99-05-20   Time: 4:59p
 * Updated in $/AntIDE/source/ant/pool/sourcepool
 * 
 * *****************  Version 6  *****************
 * User: Multipia     Date: 99-05-17   Time: 12:22a
 * Updated in $/AntIDE/source/ant/pool/sourcepool
 * 
 * *****************  Version 5  *****************
 * User: Remember     Date: 99-05-16   Time: 5:25a
 * Updated in $/AntIDE/source/ant/pool/sourcepool
 * 
 * *****************  Version 4  *****************
 * User: Remember     Date: 99-05-15   Time: 5:35a
 * Updated in $/AntIDE/source/ant/pool/sourcepool
 *
 * *****************  Version 3  *****************
 * User: Remember     Date: 99-05-14   Time: 3:23a
 * Updated in $/AntIDE/source/ant/pool/sourcepool
 *
 * *****************  Version 2  *****************
 * User: Strife       Date: 99-05-10   Time: 2:21p
 * Updated in $/AntIDE/source/ant/pool/sourcepool
 * 파일 열기 관련 수정
 *
 * *****************  Version 1  *****************
 * User: Insane       Date: 98-09-12   Time: 5:18p
 * Created in $/Ant/src/ant/sourcepool
 * 소스 관리자
 *
 */
package com.antsoft.ant.pool.sourcepool;

import java.awt.*;
import java.io.File;
import java.util.Vector;
import java.util.Hashtable;
import java.util.Enumeration;
import javax.swing.text.*;

import com.antsoft.ant.manager.projectmanager.ProjectFileEntry;

/**
 *  프로젝트별 소스를 실제로 관리하는 모듈
 *  소스 이름 = 파일 이름
 *
 *  @author Jin-woo Baek
 *  @author kim sang kyun
 */
public class SourcePool {

//  private Vector sources = new Vector(10, 5);
  private Hashtable sources = new Hashtable(10);

  /**
   *  Constructor
   */
  public SourcePool() {}

  /**
   *  Get source entry named "source_name"
   *
   *  @param pathName 찾을 소스이름
   *  @return SourceEntry 찾은 소스 엔트리
   */
  public SourceEntry getSource(String pathName, String fileName) {

    File key = new File(pathName, fileName);
    SourceEntry se = (SourceEntry)sources.get(key.getAbsolutePath());

    if (se != null) return se;
    else return openSource(pathName, fileName);
  }

  public Enumeration getOpenedSources(){
    return sources.elements();
  }

  public SourceEntry getSource(ProjectFileEntry pfe) {

    SourceEntry ret = (SourceEntry)sources.get(pfe.getFullPathName());
    if(ret != null){
      if (pfe.isExternallyChanged()) {
      	pfe.syncLastModifiedTimeWithRealFile();
      	sources.remove(pfe.getFullPathName());
        ret = openSource(pfe.getPath(), pfe.getName());
      }
    }
    else{
      ret = openSource(pfe.getPath(), pfe.getName());
    }

    return ret;
  }

  /**
   * 외부에서 변경되었을대 호출된다
   *
   * @return 만약 오픈되었던게 변경되었으면 새로운 SourceEntry를 반환하고
   * 그렇지 않으면 null을 반환한다
   */
  public SourceEntry getSourceWhenExternallyUpdated(ProjectFileEntry pfe){
    SourceEntry se = (SourceEntry)sources.get(pfe.getFullPathName());
    if(se == null)  return null;
    sources.remove(pfe.getFullPathName());
    return openSource(pfe.getPath(), pfe.getName());
  }


	/**
	 *  파일이름과 내용이 새로 만들어진 소스를 생성한다.
	 *  Class Designer로부터 생성되는 소스들을 처리한다.
	 *
	 *  @param fileName 생성될 소스의 파일 이름 (클래스 이름이 된다.)
	 *  @param fileData 생성될 소스의 내용
	 */
	public SourceEntry newSource(String pathName, String fileName, String fileData) {
  	SourceEntry se = new SourceEntry(pathName, fileName, fileData);
    sources.put(se.getFullPathName(), se);
    return se;
	}

  /**
   *  리스트에 해당 이름의 소스가 없을 경우 파일을 연다.
   *
   *  @param pathname 열 파일의 경로 이름
   *  @param filename 열 파일 이름
   *  @return SourceEntry 연 소스 반환
   */
  public SourceEntry openSource(String pathname, String filename) {
    SourceEntry se = new SourceEntry(pathname, filename);
    sources.put(se.getFullPathName(), se);
    return se;
  }

  /**
   *  더이상 어떤 View도 소스를 참조하고 있지 않으면 리스트에서 삭제한다.
   *
   *  @param source_name 삭제 대상 소스
   */
  public void deleteSource(String fullPathName) {
    sources.remove(fullPathName);
  }

  /**
   *  더이상 어떤 View도 소스를 참조하고 있지 않으면 리스트에서 삭제한다.
   *
   *  @param path 삭제 대상 소스 Path
   *  @param name 삭제 대상 소스
   */
  public void deleteSource(String path, String name) {
    File obj = new File(path, name);
    sources.remove(obj.getAbsolutePath());
  }

  public void deleteAll(){
    if(sources != null) {
      for(Enumeration e=sources.keys(); e.hasMoreElements(); ){
        String key = (String)e.nextElement();
        sources.remove(key);
      }
      sources.clear();
    }
  }

  public void addSource(SourceEntry se){
    sources.put(se.getFullPathName(), se);
  }
}
