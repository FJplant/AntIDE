/*
 * $Header: /AntIDE/source/ant/codecontext/SymbolSave.java 8     99-06-01 3:38p Kahn $
 * Ant ( JDK wrapper Java IDE )
 * Version 1.0
 * Copyright (c) 1998-1999 Antsoft Co. All rights reserved.
 *  This program and source file is protected by Korea and international
 * Copyright laws.
 *
 * $Revision: 8 $
 * Part : Symbol Save when all job over.
 * Author: Kim, Sung-hoon(kahn@antj.com)
 * Starting at 1999. 2. 10.
 */

package com.antsoft.ant.codecontext;

import java.util.*;
import java.io.*;
import com.antsoft.ant.manager.projectmanager.*;

/**
  @author Kim, sung-hoon.
  */
public class SymbolSave {//implements Runnable {
  private String path=null;
  private Project project=null;

	/**
	  default Constructor.
	  */
	public SymbolSave(String path,Project project) {
    this.path=path;
    this.project=project;
  }


  public void run() {
    Hashtable table = new Hashtable();
    //Hashtable symtabs = new Hashtable();
    //Hashtable imptabs = new Hashtable();

    Hashtable symtab=null, imptab=null;

    Vector files = project.getFiles();
    for (int i=0;i<files.size();++i) {
      ProjectFileEntry entry = (ProjectFileEntry)files.elementAt(i);
      File file = new File(entry.getPath(),entry.getName());
      if (!file.exists()) continue;

      DispatchClassInfo dispatch = new DispatchClassInfo(file);
      dispatch.makeClassInfo();
      symtab=dispatch.getTable();
      String packname=dispatch.getPackageName();

      String value = entry.getPath()+"\\"+entry.getName();

      Enumeration e = symtab.keys();
      while ( e!=null && e.hasMoreElements()) {
        String key = packname+"."+(String)e.nextElement();
        table.put(key,value);
      }
    }

		try {
			FileOutputStream ostream=new FileOutputStream(path);
			ObjectOutputStream stream=new ObjectOutputStream(ostream);

      stream.writeObject(table);

			stream.close();
			ostream.close();
		} catch (IOException e) {
			System.out.println("the exception occurred....");
		} catch (Exception e) {
			System.out.println("the exception2 occurred....");
		}
  }
}
